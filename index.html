<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gerador de Contas InfinitCast</title>
  <style>
    :root {
      --bg: #000;
      --primary: #FF0000;
      --secondary: #FFF;
      --muted: #CCC;
      --card: #1C1C1E;
      --highlight: #FF4B4B;
      --input-bg: #111;
      --border-color: #333;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
    }
    body {
      background: var(--bg);
      color: var(--secondary);
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      text-align: center;
      padding: 36px 20px;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 20px;
    }
    header h1 {
      color: var(--primary);
      font-size: 2.4rem;
      margin-bottom: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    header h1::before {
      content: 'üîë ';
    }
    header p {
      color: var(--muted);
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 18px;
      margin-top: 20px;
    }
    .card {
      background: var(--card);
      padding: 16px;
      border-radius: 14px;
      border: 1px solid var(--border-color);
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 8px 25px rgba(255, 0, 0, 0.2);
    }
    .card h2 {
      color: var(--primary);
      margin-bottom: 12px;
      font-size: 1.2rem;
    }
    .card-details {
      margin-top: 8px;
      font-size: 0.9em;
      color: var(--muted);
      word-break: break-all;
      flex-grow: 1;
    }
    .product-image {
      max-width: 150px;
      height: 150px;
      overflow: hidden;
      border-radius: 10px;
      margin: 0 auto 12px auto;
      background-color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
      transition: transform 0.3s ease;
    }
    .card:hover .product-image img {
      transform: scale(1.1);
    }
    .btn {
      padding: 10px 14px;
      border-radius: 8px;
      background: var(--primary);
      border: none;
      color: #fff;
      cursor: pointer;
      margin-top: 8px;
      width: 100%;
      font-weight: 700;
      text-transform: uppercase;
      transition: background-color 0.2s;
    }
    .btn:hover {
      background: var(--highlight);
    }
    .btn-small {
      padding: 6px 10px;
      font-size: 0.9rem;
      flex: 1;
    }
    input, select, textarea {
      padding: 10px 12px;
      width: 100%;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--input-bg);
      color: var(--secondary);
      margin-bottom: 10px;
      font-size: 1rem;
      transition: border-color 0.2s;
    }
    .flex-row {
      display: flex;
      gap: 8px;
    }
    .form-card {
      background: var(--card);
      padding: 20px;
      border-radius: 14px;
      border: 1px solid var(--border-color);
      margin-bottom: 20px;
    }
    .form-card h3 {
      color: var(--primary);
      margin-bottom: 15px;
      text-align: center;
    }
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }
    .modal {
      background: var(--card);
      padding: 24px;
      border-radius: 12px;
      width: min(680px, 92%);
      border: 1px solid var(--border-color);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.8);
    }
    .modal h3 {
      color: var(--primary);
      margin-bottom: 15px;
    }
    .modal p {
      line-height: 1.6;
    }
    .generated-code {
      font-family: monospace;
      background: #0d0d0d;
      padding: 14px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.03);
      margin: 10px 0;
      word-break: break-all;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <!-- Visualiza√ß√£o do Gerador -->
  <main id="generatorView">
    <header class="container">
      <h1>Gerador de Contas InfinitCast</h1>
    </header>
    <div class="container">
      <div class="grid" id="generatorGrid"></div>
    </div>
  </main>
  <!-- Visualiza√ß√£o do Admin -->
  <main id="adminView" style="display: none;">
    <header class="container">
      <h1>‚öôÔ∏è Painel Admin ‚Äî Gerador</h1>
      <p>Adicione, edite ou exclua produtos. Apenas campos preenchidos ser√£o exibidos no site.</p>
      <button id="backToGeneratorBtn" class="btn" style="width: auto; padding: 10px 20px; margin-top: 20px; background: #555;">Voltar para o Gerador</button>
    </header>
    <div class="container">
      <div class="form-card">
        <h3 id="formCardTitle">Adicionar Novo Produto</h3>
        <input type="text" id="nome" placeholder="Nome do Produto *" required>
        <input type="text" id="categoria" placeholder="Categoria *" required>
        <input type="url" id="imagem" placeholder="URL da Imagem (opcional)">
        <textarea id="email" rows="3" placeholder="Emails (um por linha, opcional)"></textarea>
        <textarea id="senha" rows="3" placeholder="Senhas (um por linha, opcional)"></textarea>
        <textarea id="link" rows="3" placeholder="Links (um por linha, opcional)"></textarea>
        <div id="formButtons">
          <button class="btn" id="addProduto">Adicionar</button>
        </div>
      </div>
      <h3>Produtos Cadastrados</h3>
      <div class="grid" id="adminGrid"></div>
    </div>
  </main>
  <!-- Modal de Gera√ß√£o -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <h3>Dados do Produto</h3>
      <div id="generatedCode" class="generated-code"></div>
      <div class="flex-row">
        <button class="btn" id="copyModal" style="background: var(--primary);">Copiar</button>
        <button class="btn" id="closeModal" style="background: #555;">Fechar</button>
      </div>
    </div>
  </div>
  <!-- Modal de Confirma√ß√£o de Exclus√£o -->
  <div class="modal-backdrop" id="deleteConfirmModal">
    <div class="modal">
      <h3>Confirmar Exclus√£o</h3>
      <p id="deleteConfirmText">Voc√™ tem certeza que deseja excluir este item?</p>
      <div class="flex-row" style="margin-top: 20px;">
        <button class="btn" id="confirmDeleteBtn" style="background: var(--primary);">Sim, Excluir</button>
        <button class="btn" id="cancelDeleteBtn" style="background: #555;">Cancelar</button>
      </div>
    </div>
  </div>
  <!-- Modal de Senha para Acesso Admin -->
  <div class="modal-backdrop" id="passwordPromptModal">
    <div class="modal">
      <h3>Acesso Restrito</h3>
      <p>Insira a senha para acessar o painel de administra√ß√£o.</p>
      <input type="password" id="passwordInput" placeholder="Senha" style="margin-top: 15px;">
      <p id="passwordError" style="color: var(--highlight); display: none; margin-top: 5px; font-size: 0.9em;"></p>
      <div class="flex-row" style="margin-top: 20px;">
        <button class="btn" id="submitPasswordBtn" style="background: var(--primary);">Acessar</button>
        <button class="btn" id="cancelPasswordBtn" style="background: #555;">Cancelar</button>
      </div>
    </div>
  </div>
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove, push } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB_0pZHxFYOt46qZid5VpadQ2_Wl2TdEBk",
      authDomain: "gerador-de-contas-c89b8.firebaseapp.com",
      databaseURL: "https://gerador-de-contas-c89b8-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gerador-de-contas-c89b8",
      storageBucket: "gerador-de-contas-c89b8.appspot.com",
      messagingSenderId: "392293211277",
      appId: "1:392293211277:web:8b2f2a9dda2826ec1e16c4"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const produtosRef = ref(db, 'produtos');
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- ESTADO COMPARTILHADO ---
      let produtos = [];
      let editingId = null;
      let itemIdToDelete = null;
      const adminPassword = "bras87";

      // --- ELEMENTOS DO DOM ---
      const generatorView = document.getElementById("generatorView");
      const adminView = document.getElementById("adminView");
      const generatorTitle = document.querySelector("#generatorView h1");
      const backToGeneratorBtn = document.getElementById("backToGeneratorBtn");
      const generatorGrid = document.getElementById("generatorGrid");
      const modalBackdrop = document.getElementById("modalBackdrop");
      const generatedCodeEl = document.getElementById("generatedCode");
      const copyModalBtn = document.getElementById("copyModal");
      const closeModalBtn = document.getElementById("closeModal");
      const adminGrid = document.getElementById("adminGrid");
      const formCardTitle = document.getElementById("formCardTitle");
      const formButtonsContainer = document.getElementById("formButtons");
      const nomeInput = document.getElementById("nome");
      const categoriaInput = document.getElementById("categoria");
      const imagemInput = document.getElementById("imagem");
      const emailInput = document.getElementById("email");
      const senhaInput = document.getElementById("senha");
      const linkInput = document.getElementById("link");
      const addProdutoBtn = document.getElementById("addProduto");
      const deleteConfirmModal = document.getElementById("deleteConfirmModal");
      const deleteConfirmText = document.getElementById("deleteConfirmText");
      const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
      const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");
      const passwordPromptModal = document.getElementById("passwordPromptModal");
      const passwordInput = document.getElementById("passwordInput");
      const submitPasswordBtn = document.getElementById("submitPasswordBtn");
      const cancelPasswordBtn = document.getElementById("cancelPasswordBtn");
      const passwordError = document.getElementById("passwordError");

      // --- L√ìGICA DE ALTERN√ÇNCIA DE VISUALIZA√á√ÉO ---
      let clickCount = 0;
      let clickTimer = null;
      generatorTitle.addEventListener('click', () => {
        clickCount++;
        if (clickTimer) clearTimeout(clickTimer);
        clickTimer = setTimeout(() => { clickCount = 0; }, 1000);
        if (clickCount === 5) {
          clickCount = 0;
          clearTimeout(clickTimer);
          passwordPromptModal.style.display = "flex";
          passwordInput.focus();
        }
      });

      submitPasswordBtn.addEventListener('click', () => {
        if (passwordInput.value === adminPassword) {
          passwordPromptModal.style.display = "none";
          generatorView.style.display = "none";
          adminView.style.display = "block";
          passwordError.style.display = "none";
          resetForm();
        } else {
          passwordError.textContent = "Senha incorreta. Tente novamente.";
          passwordError.style.display = "block";
          passwordInput.value = "";
          passwordInput.focus();
        }
      });

      cancelPasswordBtn.addEventListener('click', () => {
        passwordPromptModal.style.display = "none";
        passwordInput.value = "";
        passwordError.style.display = "none";
      });

      backToGeneratorBtn.addEventListener('click', () => {
        generatorView.style.display = "block";
        adminView.style.display = "none";
        resetForm();
      });

      // --- FUN√á√ïES DE RENDERIZA√á√ÉO ---
      function renderGeneratorCards() {
        generatorGrid.innerHTML = "";
        if (produtos.length === 0) return;

        produtos.forEach((p) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <div class="product-image">
              <img src="${p.imagem || 'https://placehold.co/400x300/1C1C1E/fff?text=No+Image'}" alt="Imagem do produto ${p.nome}" onerror="this.src='https://placehold.co/400x300/1C1C1E/fff?text=Imagem+Nao+Encontrada';">
            </div>
            <h2>üîê ${p.nome} (${p.categoria})</h2>
            <button class="btn">Gerar</button>
          `;
          card.querySelector("button").addEventListener("click", () => {
            let output = "";
            const emails = (p.email || "").split('\n').filter(Boolean);
            const senhas = (p.senha || "").split('\n').filter(Boolean);
            const links = (p.link || "").split('\n').filter(Boolean);
            const maxLength = Math.max(emails.length, senhas.length, links.length);
            for(let i = 0; i < maxLength; i++){
              if(emails[i]) output += `Email: ${emails[i]}\n`;
              if(senhas[i]) output += `Senha: ${senhas[i]}\n`;
              if(links[i]) output += `Link: ${links[i]}\n`;
              if (i < maxLength - 1) output += "\n";
            }
            generatedCodeEl.innerText = output.trim() || "Nenhum dado para exibir.";
            modalBackdrop.style.display = "flex";
          });
          generatorGrid.appendChild(card);
        });
      }

      function renderAdminGrid() {
        adminGrid.innerHTML = "";
        if (produtos.length === 0) {
          adminGrid.innerHTML = "<p>Nenhum produto cadastrado.</p>";
          return;
        }

        produtos.forEach((p, index) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <div>
              <div class="product-image">
                <img src="${p.imagem || 'https://placehold.co/400x300/1C1C1E/fff?text=No+Image'}" alt="Imagem do produto ${p.nome}" onerror="this.src='https://placehold.co/400x300/1C1C1E/fff?text=Imagem+Nao+Encontrada';">
              </div>
              <h2>${p.nome} (${p.categoria})</h2>
              <div class="card-details">
                ${p.email ? "Email(s): <br>" + p.email.split('\n').filter(Boolean).map(e => "‚Ä∫ " + e).join("<br>") + "<br>" : ""}
                ${p.senha ? "Senha(s): <br>" + p.senha.split('\n').filter(Boolean).map(s => "‚Ä∫ " + '‚Ä¢'.repeat(s.length)).join("<br>") + "<br>" : ""}
                ${p.link ? "Link(s): <br>" + p.link.split('\n').filter(Boolean).map(l => "‚Ä∫ " + l).join("<br>") : ""}
              </div>
            </div>
            <div class="flex-row">
              <button class="btn btn-small edit">Editar</button>
              <button class="btn btn-small delete" style="background:#555">Excluir</button>
            </div>`;

          card.querySelector(".edit").addEventListener("click", () => {
            editingId = p.id;
            nomeInput.value = p.nome;
            categoriaInput.value = p.categoria;
            imagemInput.value = p.imagem || '';
            emailInput.value = p.email || '';
            senhaInput.value = p.senha || '';
            linkInput.value = p.link || '';
            formCardTitle.textContent = "Editando Produto";
            addProdutoBtn.textContent = "Salvar Altera√ß√µes";

            if (!document.getElementById('cancelEditBtn')) {
              const cancelBtn = document.createElement('button');
              cancelBtn.id = 'cancelEditBtn';
              cancelBtn.textContent = 'Cancelar';
              cancelBtn.className = 'btn';
              cancelBtn.style.background = '#555';
              cancelBtn.addEventListener('click', resetForm);
              formButtonsContainer.appendChild(cancelBtn);
            }
            formCardTitle.scrollIntoView({ behavior: 'smooth' });
          });

          card.querySelector(".delete").addEventListener("click", () => {
            itemIdToDelete = p.id;
            deleteConfirmText.textContent = `Voc√™ tem certeza que deseja excluir "${p.nome}"?`;
            deleteConfirmModal.style.display = 'flex';
          });

          adminGrid.appendChild(card);
        });
      }

      // --- MANIPULADORES DE DADOS E EVENTOS ---
      function resetForm() {
        nomeInput.value = "";
        categoriaInput.value = "";
        imagemInput.value = "";
        emailInput.value = "";
        senhaInput.value = "";
        linkInput.value = "";
        editingId = null;
        formCardTitle.textContent = "Adicionar Novo Produto";
        addProdutoBtn.textContent = "Adicionar";
        document.getElementById('cancelEditBtn')?.remove();
      }

      addProdutoBtn.addEventListener("click", () => {
        const nome = nomeInput.value.trim();
        const categoria = categoriaInput.value.trim();
        if (!nome || !categoria) {
          if (!nome) nomeInput.style.borderColor = 'red';
          if (!categoria) categoriaInput.style.borderColor = 'red';
          setTimeout(() => {
            nomeInput.style.borderColor = 'var(--border-color)';
            categoriaInput.style.borderColor = 'var(--border-color)';
          }, 2000);
          return;
        }

        const produtoData = {
          nome,
          categoria,
          imagem: imagemInput.value.trim(),
          email: emailInput.value.trim(),
          senha: senhaInput.value.trim(),
          link: linkInput.value.trim()
        };

        if (editingId) {
          set(ref(db, `produtos/${editingId}`), produtoData);
        } else {
          push(produtosRef, produtoData);
        }

        resetForm();
      });

      // --- L√ìGICA DOS MODAIS ---
      closeModalBtn.addEventListener("click", () => modalBackdrop.style.display = "none");
      modalBackdrop.addEventListener("click", (e) => { if (e.target === modalBackdrop) modalBackdrop.style.display = "none"; });

      confirmDeleteBtn.addEventListener('click', () => {
        if (itemIdToDelete) {
          remove(ref(db, `produtos/${itemIdToDelete}`));
        }
        deleteConfirmModal.style.display = 'none';
        itemIdToDelete = null;
      });

      cancelDeleteBtn.addEventListener('click', () => {
        deleteConfirmModal.style.display = 'none';
        itemIdToDelete = null;
      });

      deleteConfirmModal.addEventListener("click", (e) => { if (e.target === deleteConfirmModal) deleteConfirmModal.style.display = "none"; });

      copyModalBtn.addEventListener("click", () => {
        const textToCopy = generatedCodeEl.innerText;
        if (!textToCopy || textToCopy === "Nenhum dado para exibir.") return;

        if (navigator.clipboard) {
          navigator.clipboard.writeText(textToCopy).then(() => {
            copyModalBtn.textContent = "Copiado!";
            setTimeout(() => { copyModalBtn.textContent = "Copiar"; }, 2000);
          }).catch(err => {
            const textArea = document.createElement("textarea");
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            copyModalBtn.textContent = "Copiado!";
            setTimeout(() => { copyModalBtn.textContent = "Copiar"; }, 2000);
          });
        }
      });

      // --- LISTENER DO FIREBASE ---
      onValue(produtosRef, (snapshot) => {
        produtos = [];
        snapshot.forEach((childSnapshot) => {
          const childKey = childSnapshot.key;
          const childData = childSnapshot.val();
          produtos.push({ id: childKey, ...childData });
        });
        renderGeneratorCards();
        renderAdminGrid();
      });
    });
  </script>
</body>
</html>
